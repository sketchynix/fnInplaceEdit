angular.module("fnInplaceEdit",[]).directive("fnEditable",["$timeout","$document",function(e,t){return{restrict:"AC",scope:{value:"=ngModel",permission:"&",save:"=",buttons:"=",containerClass:"@",type:"@fnInputType",placeholder:"@fnPlaceholder"},template:'<span ng-click="toggleInput()" ng-show="value.length > 0 && !showInput">{{value}}</span>'+'<span ng-click="toggleInput()" ng-show="value.length == 0 && !showInput">{{placeholder}}</span>'+'<div ng-show="showInput"><input ng-if="type == \'text\'" type="text" value="" ng-model="draft" />'+'<textarea ng-if="type == \'textarea\'" value="" ng-model="draft"></textarea>'+'<div><button ng-click="saveEdit()">Save</button>'+'<button ng-click="cancelEdit()">Cancel</button>'+'<button ng-repeat="button in buttons" ng-click="button.action()" class="{{button.cssClass}}">{{button.text}}</button>'+"</div></div>",replace:false,link:function(n,r,i){function a(){if(n.showInput){n.$apply(function(){n.showInput=false})}}r.addClass("fn-editable-wrap");n.draft=n.value;n.showInput=false;var s=true,o=angular.isString(n.containerClass)?n.containerClass:"shown",u=t.bind("click",a);n.saveEdit=function(){if(s){if(angular.isFunction(n.save)){n.save(n.draft)}else{n.value=n.draft}n.showInput=false}};n.cancelEdit=function(){n.draft=n.value;n.showInput=false};n.toggleInput=function(){if(s){n.showInput=true;e(function(){var e=n.type==="textarea"?r.find("textarea")[0]:r.find("input")[0];e.focus();e.select()},0)}};r.bind("keypress",function(e){if(s){e.stopPropagation();if(e.keyCode===13||e.which===13){e.preventDefault();n.$apply(n.saveEdit)}}}).bind("click",function(e){e.stopPropagation()});n.$on("$routeChangeStart",function(e,n,r){t.unbind("click",a)});n.$watch("permission",function(){if(angular.isDefined(n.permission())){s=n.permission()}});n.$watch("showInput",function(){if(n.showInput){r.addClass(o)}else{r.removeClass(o)}})}}}]);