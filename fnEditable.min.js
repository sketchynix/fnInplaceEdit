angular.module("fnInplaceEdit",[]).directive("fnEditable",["$timeout","$document",function(e,t){return{restrict:"AC",scope:{value:"=ngModel",permission:"&",save:"=",remove:"&",containerClass:"@"},template:'<span ng-click="toggleInput()">{{value}}</span>'+'<div ng-show="showInput"><input type="text" value="" ng-model="draft" />'+'<div><button ng-click="saveEdit()">Save</button>'+'<button ng-click="cancelEdit()">Cancel</button>'+'<button ng-click="removeEditable()" ng-show="showRemove">Remove</button></div></div>',replace:false,link:function(n,r,i){function u(){if(n.showInput){n.$apply(function(){n.showInput=false})}}r.addClass("fn-editable-wrap");n.showRemove=angular.isFunction(n.remove);n.draft=n.value;n.showInput=false;var s=true,o=angular.isString(n.containerClass)?n.containerClass:"shown";n.removeEditable=function(){if(angular.isFunction(n.remove)){n.remove()}};n.saveEdit=function(){if(s){if(angular.isFunction(n.save)){n.save(n.draft)}else{n.value=n.draft}n.showInput=false}};n.cancelEdit=function(){n.draft=n.value;n.showInput=false};n.toggleInput=function(){if(s){n.showInput=true;e(function(){var e=r.find("input")[0];e.focus();e.select()},0)}};r.bind("keypress",function(e){if(s){e.stopPropagation();if(e.keyCode===13||e.which===13){e.preventDefault();n.$apply(n.saveEdit)}}}).bind("click",function(e){e.stopPropagation()});var a=t.bind("click",u);n.$on("$routeChangeStart",function(e,n,r){t.unbind("click",u)});n.$watch("permission",function(){if(angular.isDefined(n.permission())){s=n.permission()}});n.$watch("showInput",function(){if(n.showInput){r.addClass(o)}else{r.removeClass(o)}})}}}])